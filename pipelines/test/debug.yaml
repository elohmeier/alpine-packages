name: Debug shell

description: |
  Drops into an interactive shell for debugging.

  REQUIRES: melange test --interactive --debug-runner <package>.yaml

  This pipeline immediately triggers the interactive debugger, giving you
  a shell inside the test VM where you can:
  - Inspect the environment
  - Debug services (rc-service, podman, etc.)
  - Access running containers
  - Use SSH port forwarding from another terminal

  Type 'exit 0' in the shell to continue the test pipeline.
  Type 'exit 1' to abort the test.

  Example usage:
    pipeline:
      - uses: test/openrc-start
        with:
          service_name: myapp-container
      - uses: test/debug  # Drop into shell to inspect
      - uses: test/openrc-stop
        with:
          service_name: myapp-container

pipeline:
  - name: "Drop into debug shell"
    runs: |
      echo ""
      echo "=============================================="
      echo "  ENTERING DEBUG MODE"
      echo "=============================================="
      echo ""
      echo "You will now get an interactive shell."
      echo ""
      echo "  - Type 'exit 0' to continue the test pipeline"
      echo "  - Type 'exit 1' to abort"
      echo ""
      echo "Useful commands:"
      echo "  rc-service <name> status    # Check service status"
      echo "  podman ps -a                # List containers"
      echo "  podman logs <container>     # View container logs"
      echo "  curl localhost:<port>       # Test endpoints"
      echo ""
      echo "SSH port forwarding (from another terminal):"
      echo "  ssh -L <local>:localhost:<remote> root@localhost -p <ssh-port>"
      echo ""
      echo "  Example for a service on port 9898:"
      echo "  ssh -L 9898:localhost:9898 root@localhost -p <ssh-port>"
      echo "  Then open http://localhost:9898 in your browser"
      echo ""
      exit 1
